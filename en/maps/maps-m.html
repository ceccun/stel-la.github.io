<!DOCTYPE html>
<html>
    <head>
        <title>New Stella Maps - What's nearby?</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Stella Maps is a mapping service.">
        <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
        <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    </head>
    <body style="overflow-x: hidden;" onload="loadcall()">
    <div>
        <div id='map' onmouseup="maptap()" class="map" style='width: 100vw; height: 100vh;'></div>
        <div style="margin-top: 100vh;" id='tray' class='tray'>
            &nbsp;
            <div class="tray-inner">
                <center>
                <div class="tray-inner-top-tab">&nbsp;<style>.tray-inner-top-tab{ width:20%; height: 8px; background-color: rgba(0,0,0,0.3); margin-top: -5px; margin-bottom: 10px; border-radius: 10px;} @media(prefers-color-scheme: dark) {
                    .tray-inner-top-tab{ background-color: rgba(255,255,255,0.3); }
                }</style></div>
            <input></input>
            <div style="margin-top: 30px;" id="tray-inner-nearby-service">
                <div id="tray-inner-nearby-loading">
                    <image style="width: 50px;" class="r-img" src="../../images/loading.gif"></image>
                </div>
                <div id="tray-inner-nearby" style="display: none;" class="tray-inner-nearby">
                    <div class="tray-inner-nearby-item"><img class="r-img" src="../../images/map/service-food-icon.png"/><p>Food</p></div>
                    <div class="tray-inner-nearby-item"><img class="r-img" src="../../images/map/service-grocery-icon.png"/><p id="groceries-label">Groceries</p></div>
                    <div class="tray-inner-nearby-item"><img class="r-img" src="../../images/map/service-gas-icon.png"/><p id="gas-label">Gas</p></div>
                    <div class="tray-inner-nearby-item"><img class="r-img" src="../../images/map/service-bed-icon.png"/><p id="hotels-label">Hotels</p></div>
                    <div id="wifi-nearby-icon" class="tray-inner-nearby-item"><img class="r-img" src="../../images/map/service-wifi-icon.png"/><p>Wi-Fi</p></div>
                </div>
                <div id="tray-inner-nearby-broken"></div>
                <script>
                    function initializeNearby(){
                        if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(e){
        console.log(e.coords.longitude);
        console.log(e.coords.latitude);
        var geocoding = new XMLHttpRequest();
        geocoding.open("GET", "https://api.mapbox.com/geocoding/v5/mapbox.places/"+ e.coords.longitude.toString() +"," + e.coords.latitude.toString() + ".json?types=place&access_token=pk.eyJ1Ijoic3RyZWFtY29tcGFueSIsImEiOiJjam1odjZsZW0yZ2t4M3ZsaG0yaHZvMmJxIn0.REMyxJ7y41LJY_nX2GGwGQ");
        geocoding.onreadystatechange = function(){
            if (this.readyState == 4 && this.status == 200){
                console.log(this.responseText);
                var json = JSON.parse(this.responseText);
                if (json.features[0].context[2].short_code == "gb"){
                    document.getElementById("hotels-label").innerText = "Stay";
                    document.getElementById("gas-label").innerText = "Petrol";
                    document.getElementById("groceries-label").innerText = "Shops";
                }
                if (json.features[0].text != "Barking"){
                    document.getElementById("wifi-nearby-icon").setAttribute("style", "display: none;");
                }
                document.getElementById("tray-inner-nearby").setAttribute("style", "");
                document.getElementById("tray-inner-nearby-loading").setAttribute("style", "display: none;");
            }
        }
        geocoding.send();
    });
  } else {
    console.log("Stella Location Services is not supported by this browser.");
  }
                    }
                </script>
            <style>
                .tray-inner-nearby{
                    display: flex;
                    justify-content: space-around;
                    align-content: stretch;
                    flex-wrap: wrap;
                }
                .tray-inner-nearby-item{
                    flex-grow: 1;
                }
                
                .tray-inner-nearby-item:active{
                    background-color: rgba(0,0,0,0.2);
                }
                .tray-inner-nearby-item p{
                    font-family: 'Inter', sans-serif;
                    margin:0;
                }
                @media (prefers-color-scheme: dark){
                    .tray-inner-nearby-item:active{
                    background-color: rgba(255,255,255,0.2);
                }
                }
            </style>
            </div>
                </center>
            </div>
        </div>
    </div>
    </body>
    <style>
        body{
            margin: 0;
            padding: 0;
            outline: none !important;
        }
        .map{
            outline: none !important;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            position: fixed !important;
            top: 0;
            z-index: -1 !important;
        }
        .tray{
            width: 100vw;
            z-index: 1;
            background-color: rgba(255,255,255,1);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding-bottom: 40px;
        }
        .tray-inner{
            margin-left: 5%;
            margin-right: 5%;
        }
        input{
            width: 90%;
            padding: 10px;
            font-size: 17px;
            background-color: rgba(0,0,0,0.3);
            border: 0;
            border-radius: 10px;
        }
        .r-img{
            opacity: 0.6;
        }
        
        p, h1, h2, h3, h4, h5, h6{
                    font-family: 'Inter', sans-serif;
                    opacity: 0.7;
                }

        @media(prefers-color-scheme: dark){
            p, h1, h2, h3, h4, h5, h6{
                    font-family: 'Inter', sans-serif;
                    color: white;
                }
            .tray{
            background-color: rgba(0,0,0,1);
        }
        input{
            width: 90%;
            padding: 10px;
            font-size: 17px;
            background-color: rgba(255,255,255,0.3);
            border: 0;
            border-radius: 10px;
        }
        .r-img{
            filter: invert();
        }
        }
    </style>
    <script>
        function loadcall(){
            document.getElementById("tray").setAttribute("style", "margin-top:" + (window.innerHeight - 31) + "px;");
        window.scroll({top: 100, left: 0, behavior: "smooth"});
        var x = document.getElementById("demo");
        initializeNearby();
        }

        function maptap(){
            window.scroll({
  top: 0,
  left: 0,
  behavior: 'smooth'
});
        }
    </script>
            <script>
                mapboxgl.accessToken = 'pk.eyJ1Ijoic3RyZWFtY29tcGFueSIsImEiOiJjam1odjZsZW0yZ2t4M3ZsaG0yaHZvMmJxIn0.REMyxJ7y41LJY_nX2GGwGQ';
                var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11'
                });
                </script>
</html>