<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>eMap - explore</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />
<style>
 @font-face{
	 font-family: 'stella.typeface'; 
	 src: url('../fonts/stellanorm.otf');
 }
  @font-face{
	 font-family: 'stella.typeface';
	 font-weight: bold;
	 src: url('../fonts/stellabold.otf');
 }
	body { 
	margin: 0; 
	padding: 0; 
	}
	
	#map { 
	position: absolute; 
	top: 0; 
	bottom: 0; 
	width: 100%; 
	}
	
	a.mapboxgl-ctrl-logo { 
	display: none; 
	}
	
	.mapboxgl-ctrl-bottom-right { 
	display: none; 
	}
	
	.mapboxgl-ctrl-geocoder.mapboxgl-ctrl {
	position: absolute;
	left: 30px;
	margin-top: 60px;
	border-radius: 10px;
	box-shadow: 0 0 0 0;
	padding: 1px;
	max-width: 100vw;
	width: 30vw;
	background-color: rgba(255,255,255,0.5);
	backdrop-filter: blur(5px);
	-webkit-backdrop-filter: blur(5px);
	font-family: 'stella.typeface', sans-serif;
	}
	
	.mapboxgl-ctrl-top-right {
	width: 100vw; 
	}
	.mapboxgl-ctrl.mapboxgl-ctrl-group{
		background-color: rgba(255,255,255,0.5);
	backdrop-filter: blur(5px);
	-webkit-backdrop-filter: blur(5px);
	font-family: 'stella.typeface', sans-serif;
	}
	.title{
	position: fixed;
	z-index: 10;
	top: 7px;
	padding: 10px;
	font-family: 'stella.typeface', sans-serif;
	margin-top: 0px;
	margin-left: 20px;
	color: rgba(0,0,0,0.9);
	}
</style>
</head>
<body>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.min.js"></script>
<link
rel="stylesheet"
href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.2/mapbox-gl-geocoder.css"
type="text/css"
/>
<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<div id="map"></div>
<script>
	const locationget = new XMLHttpRequest();
locationget.onreadystatechange = function() {
if (this.readyState == 4 && this.status == 200) {
var response = JSON.parse(this.response);
map(response.longitude, response.latitude)
}
};
locationget.open("GET", "https://ipapi.co/json", true);
locationget.send();
	
	function map(lon, lat){
	mapboxgl.accessToken = 'pk.eyJ1Ijoic3RyZWFtY29tcGFueSIsImEiOiJjam1odjZsZW0yZ2t4M3ZsaG0yaHZvMmJxIn0.REMyxJ7y41LJY_nX2GGwGQ';
var map = new mapboxgl.Map({
container: 'map', // container id
style: 'mapbox://styles/mapbox/streets-v11',
center: [lon, lat], // starting position
zoom: 14 // starting zoom
});
 map.addControl(
new MapboxGeocoder({
accessToken: mapboxgl.accessToken,
mapboxgl: mapboxgl
})
);
// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.NavigationControl());
	}
</script>
<h1 class="title">eMap</h1>
<a href="about.html" target="_BLANK">
<div style="position: fixed; bottom: 10px; background-color: rgba(255,255,255,0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); padding: 2px; border-radius: 10px; right: 10px;"><img width="25px" style="text-align: center; margin: 0; padding: 0;" src="../images/info.png"></div></a>
<div id="databox" style="position: fixed; bottom: 80px; background-color: rgba(255,255,255,0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); padding: 10px; border-radius: 10px; right: 10px; width: 300px;"><h3 style="margin: 0; font-family: 'stella.typeface', sans-serif">Data Enforcement</h3><p style="margin: 0; font-family: 'stella.typeface', sans-serif;">stella and MapBox collect data on your visit to help improve The eMap service. Data collected do not contain information that can uniquely identify you and will only be used for debugging and recreation purposes.</p><button onclick="permit()" style="border-radius: 10px; padding: 10px; background-color: rgba(255, 0, 68,0.5); border: none; margin-top: 5px;"><script>
function permit(){
document.getElementById("databox").setAttribute("style", "position: fixed; bottom: 80px; background-color: rgba(255,255,255,0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); padding: 10px; border-radius: 10px; right: 10px; width: 300px; display: none;");
}
	map.on('load', function() {
// Insert the layer beneath any symbol layer.
var layers = map.getStyle().layers;
 
var labelLayerId;
for (var i = 0; i < layers.length; i++) {
if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
labelLayerId = layers[i].id;
break;
}
}
 
map.addLayer(
{
'id': '3d-buildings',
'source': 'composite',
'source-layer': 'building',
'filter': ['==', 'extrude', 'true'],
'type': 'fill-extrusion',
'minzoom': 15,
'paint': {
'fill-extrusion-color': '#aaa',
 
// use an 'interpolate' expression to add a smooth transition effect to the
// buildings as the user zooms in
'fill-extrusion-height': [
'interpolate',
['linear'],
['zoom'],
15,
0,
15.05,
['get', 'height']
],
'fill-extrusion-base': [
'interpolate',
['linear'],
['zoom'],
15,
0,
15.05,
['get', 'min_height']
],
'fill-extrusion-opacity': 0.6
}
},
labelLayerId
);
});
	
</script>Permit</button></div>
</body>
</html>
